# react-native-template

Project is generated by 
- [React Native CLI](https://reactnative.dev/docs/environment-setup#installing-dependencies).

//TODO:
- [ ] Add [React Navigation](https://reactnavigation.org/docs/en/getting-started.html)
- [ ] Add [Styled Components](https://www.styled-components.com/docs/basics)
- [ ] Add [Jest](https://jestjs.io/docs/en/getting-started)


Please read [High-level Architecture](https://confluence-aholddelhaize.atlassian.net/wiki/spaces/RTPE/pages/147700227545/React+Native+Enablement+High+Level+Architecture) to see the context of a React Native App in the RTP landscape.

## Overview

This repository is an example of React Native Application. Use this template when you start developing new app.

This repository is owned by [RTP Enablement team](http://add-link-to-the-team-channel)

_Fill in here your application purpose, and it's main functionalities. Also insert the link to your architecture from confluence._

## Prerequisites
Please make sure that you have installed 
- [React Native CLI](https://reactnative.dev/docs/environment-setup#installing-dependencies) 
- [React Native](https://reactnative.dev/docs/getting-started).
  - NPM (Node Package Manager)
    - ```shell
      npm install npm@latest -g
  - Yarn
    - ```shell
      npm install -g yarn

## How to start

1. Follow [React Native guidelines](https://reactnative.dev/docs/environment-setup#installing-dependencies) to configure your development environment for both iOS and Androd;
2. Install dependencies with `yarn`;
3. Launch metro server with `yarn start`;
4. Choose platform you want to work with by running:
   1. `yarn ios`;
   2. `yarn android` _(Android requires to launch an emulator or connected device beforehand)_;

## Structure

```
react-native-template
├──android - android project;
├──ios - ios project;
├──e2e - E2E tests;
└──src - source code;
    ├──components - common components for all screens;
    ├──enums - common enums for all screens and components;
    ├──hooks - common hooks for all screens and components;
    ├──interfaces - common interfaces for all screens and components;
    ├──localization - common interfaces for all screens and components;
    │  ├──context - context that contains translations for the current language;
    │  └──locales - translations for different languages, grouped by namespace;
    ├──screens - all application screens;
    ├──store - redux store for the app;
    ├──test - setting up common mocks for tests;
    ├──app.tsx - entry point;
    └──routes.tsx - all navigation routes for the app;
```

## Guidelines

### Component Structure

```
component
├──component.tsx - component code;
├──component.styles.ts - component style sheet;
├──component.hooks.ts - component hooks;
├──component.hooks.spec.ts - hooks test;
├──component.spec.ts - component test (with snapshot and functional test);
└──component.story.ts - component story to showcase its features
```

### Handling components growth

If a component gets big and complex consider:

1. Decompose the component into smaller components
   1. If some parts are reusable across other components, extract them to the root `components` folder;
   2. If these parts are specific to this component, consider creating `components` folder inside and place those components there. They should also follow the component structure rules;
2. Create dedicated hook file, to simplify render function. By moving state and functions that operate with state or redux, you can see how component file becomes more about its structure;
3. Do we have a group of components that serve the same purpose, consider grouping them in a dedicated folder (e.g.: `components/cards` for all card components)

### Testing

When testing components:

1. Mock dependencies (don't retest other components/hooks);
2. Make snapshots for props variations;
3. Test firing events at your component (e.g.: press, type, scroll);

When testing hooks include testing not only functions and state, but also effects.

_you can check test examples in `src/screens/todo`_

### Localization

You can store all text labels in `src/localization/locales` folder.
`common` folder is mandatory to have.
However, you can create more and register those files in `src/localization/context/localization-data`.
This will help to reduce file size and manage translations more easily.

To use translations in a component or a hook call `useLocalization`.

Example:

```tsx
const MyComponent = () => {
  const { t } = useLocalize();

  return <Text>{t('translation-key-from-json')}</Text>;
};
```

By default `t('key')` picks up translation from the `common` folder.
If you want to use another folder, then prefix key with `folder-name:`.
That allows you to use translations from different folders.

Example:

```tsx
const MyComponent = () => {
  const { t } = useLocalize();

  return (
    <>
      <Text>{t('common-translation-key')}</Text>
      <Text>{t('folder-name:folder-specific-translation-key')}</Text>
    </>
  );
};
```

If you need to insert text inside your translation, use interpolation by wrapping text with `{{parameter}}`

Example translation file

```json
{
  "key1": "Hello",
  "key2": "Hello {{name}}"
}
```

Code example

```tsx
const MyComponent = () => {
  const { t } = useLocalize();

  return (
    <>
      <Text>{t('key1')}</Text>
      <Text>{t('key2', { params: { name: 'My Name' } })}</Text>
    </>
  );
};
```

If you need to insert JSX inside your translation, use interpolation by wrapping text with `<parameter>Some text</parameter>`

Example translation file

```json
{
  "key1": "Hello",
  "key2": "Hello <name>My name</name>"
}
```

Code example

```tsx
const MyComponent = () => {
  const { tJSX } = useLocalize();

  return (
    <>
      <Text>{t('key1')}</Text>
      <Text>
        {tJSX('key2', {
          components: { name: ({ children }) => <Text>{children}</Text> },
        })}
      </Text>
    </>
  );
};
```

## ENV variables

Create a `.env` file in the root and fill like this:

```
MY_ENV=my-env
```

Then you need to declare your variables in the file `src/types/env.d.ts`:

```ts
declare module '@env' {
  //...
  export const MY_ENV: string;
}
```

### Usage

Code example:

```ts
import { MY_ENV } from '@env';

console.log(MY_ENV); // my-env
```

### Changing variables

Metro caches env variables. If you want to change a variable you will need to run the following command after changes:

```
yarn start --reset-cache
```

Then you can run `yarn ios` or `yarn android` with updated env variables.

## Firebase Analytics and Crashlytics

### Setup Android

Download <b>google-services.json</b> and replace it with the file with the same name in the folder <b>android/app</b>.

More info [here](https://rnfirebase.io/#generating-android-credentials).

### Setup iOS

Download <b>GoogleService-Info.plist</b>. Using Xcode, open the projects <b>/ios/{projectName}.xcodeproj</b> file (or <b>/ios/{projectName}.xcworkspace</b> if using Pods).

Right click on the project name and "Add files" to the project.

Select the downloaded <b>GoogleService-Info.plist</b> file from your computer, and ensure the "Copy items if needed" checkbox is enabled.

More info [here](https://rnfirebase.io/#generating-ios-credentials).

### DebugView

To enable DebugView on <b>Android</b> you should launch an Android emulator and run the command `adb shell setprop debug.firebase.analytics.app package_name`.
To disable you should run `adb shell setprop debug.firebase.analytics.app .none.`.

To enable DebugView on <b>iOS</b> you should select the argument `-FIRDebugEnabled` and discard `-FIRDebugDisabled` in the Xcode (Choose the project -> Product -> Scheme -> Edit scheme -> Arguments). Then you need to build iOS project by `yarn ios`.

**Troubleshooting**

If you don't see your iOS device in DebugView you may need to start the project through `yarn start --resetCache` and build it in Xcode.

### Usage

To send some <b>analytics information</b> to the Firebase Console you can use the method `logEvent` with an event name and additional information:

```tsx
const TodosListItem: FC<TodosListItemProps> = ({ todo, onSelect }) => {
  const handlePress = async () => {
    await analytics().logEvent('todo_click', { id: todo.id });
    onSelect(todo.id);
  };

  return (
    <TouchableOpacity style={styles.root} onPress={handlePress}>
      <Text style={todo.isDone && styles.completedTodo}>{todo.text}</Text>
    </TouchableOpacity>
  );
};
```

To send <b>crash reports</b> to the Firebase Console you can use the method `recordError`:

```tsx
const CrashAppButton = () => {
  const handleCrashApp = () => {
    crashlytics().recordError(new Error('Crash by click on the crush button'));
  };

  return (
    <View style={styles.container}>
      <Button title="Crash App" onPress={handleCrashApp} />
    </View>
  );
};
```

More methods of Firebase Analytics and Crashlytics you can find [here](https://rnfirebase.io/).

## E2E testing

We use [Detox](https://wix.github.io/Detox/docs/introduction/getting-started) to run E2E tests.

Firstly, you should setup Environments:

- [iOS](https://wix.github.io/Detox/docs/introduction/ios-dev-env)
- [Java for Android](https://wix.github.io/Detox/docs/introduction/android-dev-env#java-setup)

### Android

You need to create an emulator with the following parameters:

- Device: <b>Pixel 5</b>
- System image: <b>Pie (Android 9.0)</b>
- AVD Name: <b>Pixel 5 E2E</b>

Then check the Kotlin version: <b>Open Android Studio > More Actions > SDK Manager > in the left sidebar click on 'Kotlin' > click 'install' if this button exists.</b>

### iOS

You should have <b>iPhone 13</b> from the xCode by default.

### Running tests

Before running your tests you must compile the application. Run `yarn e2e:ios:build` for iOS and `e2e:android:build` for Android.

Then you can execute `yarn e2e:ios:start` to run tests on iOS and `yarn e2e:android:start` on Android.
